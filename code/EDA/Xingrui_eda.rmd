
# Data Prep

```{r, show_col_types = FALSE}
library(readr)
library(tidyverse)

heat_check <- read_csv("../../data/heat_check_tournament_index.csv")
big_dance <- read_csv("../../data/Big_Dance_CSV.csv")
kenpom_data <- read_csv("../../data/kenpom_tournament_clean.csv")
tournament_matchups <- read_csv("../../data/tournament_matchups.csv")
upsetdata <- read_csv("../../data/regular_season_stats_of_all_tournament_team_matchups_2007_2019.csv")

# Inspect the data
head(heat_check)
head(big_dance)
head(kenpom_data)
head(tournament_matchups)
```
# Data Wrangling

```{r}
heat_check <- heat_check %>% rename(Season = YEAR)
big_dance <- big_dance %>% rename(Season = Year)
names(big_dance) <- str_replace(names(big_dance), "\\...\\d+$", "")
tournament_matchups <- tournament_matchups %>% rename(Season = YEAR)
kenpom_data <- kenpom_data %>%
  select(-1)
```

# Some EDA

```{r}
glimpse(heat_check)
summary(heat_check)
```

```{r}
# Histogram of PATH difficulty
ggplot(heat_check, aes(x=PATH)) +
  geom_histogram(binwidth=1, fill="blue", color="white") +
  labs(title="Histogram of PATH Difficulty", x="PATH Difficulty", y="Count")

# Boxplot of POWER by SEED
ggplot(heat_check, aes(x=factor(SEED), y=POWER)) +
  geom_boxplot() +
  labs(title="Boxplot of Team Power by Seed", x="Seed", y="Power")

```
```{r}
# Correlation matrix of selected variables
selected_variables <- heat_check %>% select(POWER, PATH, WINS, `POOL VALUE`)
correlation_matrix <- cor(selected_variables, use="complete.obs")  # Handling missing values
print(correlation_matrix)

# Visualizing the correlation matrix
library(corrplot)
corrplot(correlation_matrix, method="circle")

```
```{r}
# Scatter plot of POWER vs. PATH
ggplot(heat_check, aes(x=POWER, y=PATH)) +
  geom_point(aes(color=factor(SEED)), alpha=0.6) +
  labs(title="Scatter Plot of POWER vs. PATH by SEED", x="POWER", y="PATH")+
  geom_smooth(method="lm")

```






```{r}
seed_expectations <- c(
  `1`=5,
  `2`=4,    
  `3`=4,    
  `4`=3,    
  `5`=3,
  `6`=2,   
  `7`=2,    
  `8`=2,    
  `9`=1,    
  `10`=1,   
  `11`=1,   
  `12`=1,   
  `13`=0,  
  `14`=0,
  `15`=0,   
  `16`=0    
)

# 1 means  elite eight or better
# 2 - 3 means sweet sixteen or better
# 4 -8 means round of 32 or better
# 9 - 12 means the team enter first round
# 13 - 16 means typically lose in first round

# Analyze upsets based on PATH difficulty
heat_check <- heat_check %>%
  mutate(Upset = ROUND > seed_expectations[as.character(SEED)]) %>%
  mutate(Upset = ifelse(Upset, "Upset", "No Upset"))

# Visualizing the distribution of PATH difficulty for Upsets
ggplot(heat_check, aes(x=Upset, y=PATH, fill=Upset)) +
  geom_violin(trim=FALSE) +
  labs(title="Distribution of Path Difficulty Based on Upset Status", x="Upset Status", y="Path Difficulty") +
  theme_minimal()
```

```{r}
library(dplyr)
library(e1071)  # Support for SVM
library(caret)  # For data partitioning and preprocessing


# Check initial data structure
str(heat_check)

# Convert 'Upset' to a factor with the correct levels


# Handling missing values
heat_check <- na.omit(heat_check)  # Remove rows with any NAs

# Re-check the structure and balance of 'Upset'
table(heat_check$Upset)

# Ensure there's a sufficient number of instances for each class
if(any(table(heat_check$Upset) < 10)) {
  stop("Not enough data points for each class in 'Upset'. Consider data collection or augmentation.")
}

# Select relevant features and the target
features <- heat_check %>%
  select(SEED, PATH, POWER, `POWER-PATH`, WINS, Upset)

```




